@page "/editprofile"                                                                                                                                                                                                                                                                                                                                                       
 @inject Blazored.LocalStorage.ILocalStorageService localStorage                                                                                                                                                                                                                                                                                                            
 @inject ILoginService loginService                                                                                                                                                                                                                                                                                                                                         
 @inject NavigationManager navManager                                                                                                                                                                                                                                                                                                                                       
 @using webapp.Service                                                                                                                                                                                                                                                                                                                                                      
 @using core.Models                                                                                                                                                                                                                                                                                                                                                         
 @using webapp.Service.LoginService                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                            
 <h3>Profiloversigt</h3>                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
 <div class="edit-profile-form">                                                                                                                                                                                                                                                                                                                                            
     <EditForm Model="@user" OnValidSubmit="HandleValidSubmit">                                                                                                                                                                                                                                                                                                                 
     <DataAnnotationsValidator />                                                                                                                                                                                                                                                                                                                                           
     <ValidationSummary />

         <div class="form-group">
             <label for="firstName">Fornavn</label>
             <InputText id="firstName" class="form-control" @bind-Value="user.FirstName" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="lastName">Efternavn</label>
             <InputText id="lastName" class="form-control" @bind-Value="user.LastName" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="email">Email</label>
             <InputText id="email" class="form-control" @bind-Value="user.Email" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="password">Adgangskode</label>
             <InputText id="password" class="form-control" @bind-Value="user.Password" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="phoneNumber">Telefonnummer</label>
             <InputText id="phoneNumber" class="form-control" @bind-Value="user.PhoneNumber" disabled="@(!isEditable)" />
         </div>
                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                            
     <button type="button" class="btn btn-primary" style="margin-top: 20px" @onclick="ToggleEditMode">                                                                                                                                                                                                                                                                      
         @(isEditable ? "Gem profil" : "Rediger profil")                                                                                                                                                                                                                                                                                                                          
     </button>                                                                                                                                                                                                                                                                                                                                                              
 </EditForm>                                                                                                                                                                                                                                                                                                                                                                
 </div>                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                            
 @code {                                                                                                                                                                                                                                                                                                                                                                    
     private User user = new User();                                                                                                                                                                                                                                                                                                                                        
     private bool isEditable = false;                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                            
     protected override async Task OnInitializedAsync()                                                                                                                                                                                                                                                                                                                     
     {                                                                                                                                                                                                                                                                                                                                                                      
         try                                                                                                                                                                                                                                                                                                                                                                
         {                                                                                                                                                                                                                                                                                                                                                                  
             user = await loginService.GetCurrentUser();                                                                                                                                                                                                                                                                                                                   
             if (user == null)                                                                                                                                                                                                                                                                                                                                              
             {                                                                                                                                                                                                                                                                                                                                                              
                 navManager.NavigateTo("login/userprofile");                                                                                                                                                                                                                                                                                                                
             }                                                                                                                                                                                                                                                                                                                                                              
         }                                                                                                                                                                                                                                                                                                                                                                  
         catch (Exception ex)                                                                                                                                                                                                                                                                                                                                               
         {                                                                                                                                                                                                                                                                                                                                                                  
             // Håndter fejl, f.eks. logge eller vise en fejlmeddelelse                                                                                                                                                                                                                                                                                                     
         }                                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private async Task HandleValidSubmit()                                                                                                                                                                                                                                                                                                                                 
     {                                                                                                                                                                                                                                                                                                                                                                      
         try                                                                                                                                                                                                                                                                                                                                                                
         {                                                                                                                                                                                                                                                                                                                                                                  
             await SaveUserData(user);                                                                                                                                                                                                                                                                                                                                      
         }                                                                                                                                                                                                                                                                                                                                                                  
         catch (Exception ex)                                                                                                                                                                                                                                                                                                                                               
         {                                                                                                                                                                                                                                                                                                                                                                  
             // Håndter fejl, f.eks. logge eller vise en fejlmeddelelse                                                                                                                                                                                                                                                                                                     
         }                                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private async Task SaveUserData(User user)                                                                                                                                                                                                                                                                                                                             
     {                                                                                                                                                                                                                                                                                                                                                                      
         // Implementer logik for at gemme brugerdata til en service                                                                                                                                                                                                                                                                                                        
         // For eksempel, kald UserService for at gemme brugerdata                                                                                                                                                                                                                                                                                                          
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private void ToggleEditMode()                                                                                                                                                                                                                                                                                                                                          
     {                                                                                                                                                                                                                                                                                                                                                                      
         isEditable = !isEditable;  
         StateHasChanged();
     }                                                                                                                                                                                                                                                                                                                                                                      
 } 