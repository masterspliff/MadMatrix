@page "/editprofile"                                                                                                                                                                                                                                                                                                                                                       
 @inject Blazored.LocalStorage.ILocalStorageService localStorage                                                                                                                                                                                                                                                                                                            
 @inject ILoginService loginService                                                                                                                                                                                                                                                                                                                                         
 @inject NavigationManager navManager                                                                                                                                                                                                                                                                                                                                       
 @inject IUserService UserService                                                                                                                                                                                                                                                                                     
 @using System.Diagnostics.Metrics @using webapp.Service                                                                                                                                                                                                                                                                                                                                                      
 @using core.Models                                                                                                                                                                                                                                                                                                                                                         
 @using webapp.Service.LoginService

 <h3>Profiloversigt</h3>                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
 <div class="edit-profile-form">                                                                                                                                                                                                                                                                                                                                            
     <EditForm Model="@user" OnValidSubmit="HandleValidSubmit">                                                                                                                                                                                                                                                                                                                 
     <DataAnnotationsValidator />                                                                                                                                                                                                                                                                                                                                           
     <ValidationSummary />

         <div class="form-group">
             <label for="firstName">Fornavn</label>
             <InputText id="firstName" class="form-control" @bind-Value="user.FirstName" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="lastName">Efternavn</label>
             <InputText id="lastName" class="form-control" @bind-Value="user.LastName" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="email">Email</label>
             <InputText id="email" class="form-control" @bind-Value="user.Email" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="password">Adgangskode</label>
             <InputText id="password" class="form-control" @bind-Value="user.Password" disabled="@(!isEditable)" />
         </div>

         <div class="form-group">
             <label for="phoneNumber">Telefonnummer</label>
             <InputText id="phoneNumber" class="form-control" @bind-Value="user.PhoneNumber" disabled="@(!isEditable)" />
         </div>
                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                            
         <button type="button" class="btn btn-primary" style="margin-top: 20px" @onclick="HandleButtonClick">                                                                                                                                                                                                                                                                      
             @(isEditable ? "Gem profil" : "Rediger profil")
         </button>
         <div>@saveMessage</div>
     </EditForm>                                                                                                                                                                                                                                                                                                                                                                
 </div>                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                            
  @code {                                                                                                                                                                                                                                                                                                                                                                    
     private User user = new User();                                                                                                                                                                                                                                                                                                                                        
     private bool isEditable = false;                                                                                                                                                                                                                                                                                                                                       
     private string saveMessage;                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                            
     [Inject]                                                                                                                                                                                                                                                                                                                                                               
     private IUserService userService { get; set; }                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                            
     protected override async Task OnInitializedAsync()                                                                                                                                                                                                                                                                                                                     
     {                                                                                                                                                                                                                                                                                                                                                                      
         try                                                                                                                                                                                                                                                                                                                                                                
         {                                                                                                                                                                                                                                                                                                                                                                  
             user = await loginService.GetCurrentUser();                                                                                                                                                                                                                                                                                                                    
             if (user == null)                                                                                                                                                                                                                                                                                                                                              
             {                                                                                                                                                                                                                                                                                                                                                              
                 navManager.NavigateTo("/dashboard");                                                                                                                                                                                                                                                                                                                       
             }                                                                                                                                                                                                                                                                                                                                                              
         }                                                                                                                                                                                                                                                                                                                                                                  
         catch (Exception ex)                                                                                                                                                                                                                                                                                                                                               
         {                                                                                                                                                                                                                                                                                                                                                                  
             // Håndter fejl, f.eks. logge eller vise en fejlmeddelelse                                                                                                                                                                                                                                                                                                     
         }                                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private async Task HandleValidSubmit()                                                                                                                                                                                                                                                                                                                                 
     {                                                                                                                                                                                                                                                                                                                                                                      
         try                                                                                                                                                                                                                                                                                                                                                                
         {                                                                                                                                                                                                                                                                                                                                                                  
             await SaveUserData(user);                                                                                                                                                                                                                                                                                                                                      
         }                                                                                                                                                                                                                                                                                                                                                                  
         catch (Exception ex)                                                                                                                                                                                                                                                                                                                                               
         {                                                                                                                                                                                                                                                                                                                                                                  
             // Håndter fejl, f.eks. logge eller vise en fejlmeddelelse                                                                                                                                                                                                                                                                                                     
         }                                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private void ToggleEditMode()                                                                                                                                                                                                                                                                                                                                          
     {                                                                                                                                                                                                                                                                                                                                                                      
         isEditable = !isEditable;                                                                                                                                                                                                                                                                                                                                          
         StateHasChanged();                                                                                                                                                                                                                                                                                                                                                 
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     private async Task HandleButtonClick()                                                                                                                                                                                                                                                                                                                                 
     {                                                                                                                                                                                                                                                                                                                                                                      
         if (isEditable)                                                                                                                                                                                                                                                                                                                                                    
         {                                                                                                                                                                                                                                                                                                                                                                  
             await HandleValidSubmit();                                                                                                                                                                                                                                                                                                                                     
         }                                                                                                                                                                                                                                                                                                                                                                  
         ToggleEditMode();                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                            
     public async Task SaveUserData(User user)                                                                                                                                                                                                                                                                                                                              
     {                                                                                                                                                                                                                                                                                                                                                                      
         try                                                                                                                                                                                                                                                                                                                                                                
         {                                                                                                                                                                                                                                                                                                                                                                  
             await userService.UpdateUser(user);                                                                                                                                                                                                                                                                                                                            
             saveMessage = "Ændringerne er blevet gemt.";                                                                                                                                                                                                                                                                                                                   
             StateHasChanged();                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                            
             // Start en timer for at nulstille beskeden efter 2 sekunder                                                                                                                                                                                                                                                                                                   
             await Task.Delay(2000);                                                                                                                                                                                                                                                                                                                                        
             saveMessage = string.Empty;                                                                                                                                                                                                                                                                                                                                    
             StateHasChanged();                                                                                                                                                                                                                                                                                                                                             
         }                                                                                                                                                                                                                                                                                                                                                                  
         catch (Exception ex)                                                                                                                                                                                                                                                                                                                                               
         {                                                                                                                                                                                                                                                                                                                                                                  
             saveMessage = "Der opstod en fejl under gemning.";                                                                                                                                                                                                                                                                                                             
             StateHasChanged();                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                            
             // Start en timer for at nulstille beskeden efter 2 sekunder                                                                                                                                                                                                                                                                                                   
             await Task.Delay(2000);                                                                                                                                                                                                                                                                                                                                        
             saveMessage = string.Empty;                                                                                                                                                                                                                                                                                                                                    
             StateHasChanged();                                                                                                                                                                                                                                                                                                                                             
         }                                                                                                                                                                                                                                                                                                                                                                  
     }                                                                                                                                                                                                                                                                                                                                                                      
 }   
